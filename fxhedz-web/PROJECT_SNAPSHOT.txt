
==================================================
PROJECT STRUCTURE
==================================================

.env.local
.gitignore
app\api\auth\[...nextauth]\route.ts
app\api\public-preview\route.ts
app\api\signals\route.ts
app\api\subscription\route.ts
app\globals.css
app\layout.tsx
app\page.tsx
components\AccessOverlay.tsx
components\AccountStrip.tsx
components\AuthButton.tsx
components\DashboardControlBar.tsx
components\GlobalLightChart.tsx
components\PairCard.tsx
components\PairDetail.tsx
components\Providers.tsx
components\VerticalSymbolButton.tsx
eslint.config.mjs
GAS.txt
MT5.txt
next.config.ts
next-env.d.ts
package.json
package-lock.json
postcss.config.js
public\file.svg
public\globe.svg
public\logo.png
public\next.svg
public\vercel.svg
public\window.svg
tailwind.config.js
tsconfig.json

==================================================
FULL SOURCE CODE
==================================================


// app\api\auth\[...nextauth]\route.ts
// --------------------------------------------------

import NextAuth, { type NextAuthOptions } from "next-auth"
import GoogleProvider from "next-auth/providers/google"
import { cookies } from "next/headers"

export const authOptions: NextAuthOptions = {
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
  ],

  secret: process.env.NEXTAUTH_SECRET,

  callbacks: {
async signIn({ user }) {
  try {
    if (user?.email) {

      const cookieStore = await cookies()
      const deviceId = cookieStore.get("fx_device")?.value || ""

      // ðŸ”¥ read fingerprint cookie too
      const fingerprint = cookieStore.get("fx_fp")?.value || ""

      await fetch(process.env.GAS_AUTH_URL!, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: user.email,
          device_id: deviceId,
          fingerprint: fingerprint
        }),
      })
    }
  } catch (e) {
    console.error("Auth sync failed:", e)
  }

  return true
}
  }
}

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }



// app\api\public-preview\route.ts
// --------------------------------------------------

import { NextResponse } from "next/server"

const GAS_BASE =
  "https://script.google.com/macros/s/AKfycby55ye_dTtWJ-QILNYJIaXWv74_n7n0muh3U--sBl7yowMlp1FzESOokWqeHI75U5_R/exec"

export async function GET() {
  try {
    const res = await fetch(
      `${GAS_BASE}?secret=${process.env.GAS_SECRET}&pair=XAUUSD`,
      {
        next: { revalidate: 10 }
      }
    )

    const json = await res.json()

    return NextResponse.json({
      direction: json?.direction,
      price: json?.price,
      entry: json?.entry,
      sl: json?.sl,
      tp: json?.tp,
      candles: json?.candles?.slice(-40) || []
    })

  } catch {
    return NextResponse.json(
      { error: "Preview unavailable" },
      { status: 500 }
    )
  }
}



// app\api\signals\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { getServerSession } from "next-auth"
import { authOptions } from "../auth/[...nextauth]/route"

const GAS_BASE =
  "https://script.google.com/macros/s/AKfycby55ye_dTtWJ-QILNYJIaXWv74_n7n0muh3U--sBl7yowMlp1FzESOokWqeHI75U5_R/exec"

export async function GET(req: NextRequest) {

  // 1ï¸âƒ£ LOGIN REQUIRED
  const session = await getServerSession(authOptions)

  if (!session?.user?.email) {
    return NextResponse.json(
      { error: "Login required" },
      { status: 401 }
    )
  }

  // 2ï¸âƒ£ DEVICE REQUIRED
  const deviceId = req.cookies.get("fx_device")?.value
  const fingerprint = req.nextUrl.searchParams.get("fingerprint") || ""

  if (!deviceId || !fingerprint) {
    return NextResponse.json(
      { error: "No device" },
      { status: 401 }
    )
  }

  try {

    const pair = req.nextUrl.searchParams.get("pair")

    const url = pair
      ? `${GAS_BASE}?secret=${process.env.GAS_SECRET}&pair=${pair}&device_id=${deviceId}&fingerprint=${encodeURIComponent(fingerprint)}`
      : `${GAS_BASE}?secret=${process.env.GAS_SECRET}&device_id=${deviceId}&fingerprint=${encodeURIComponent(fingerprint)}`

    const res = await fetch(url, { cache: "no-store" })
    const json = await res.json()

    if (!json?.active) {
      return NextResponse.json(
        { error: "Subscription required" },
        { status: 403 }
      )
    }

    return NextResponse.json(json)

  } catch {
    return NextResponse.json(
      { error: "Signal fetch failed" },
      { status: 500 }
    )
  }
}



// app\api\subscription\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"

export async function GET(req: NextRequest) {

  const deviceId = req.cookies.get("fx_device")?.value
  const fingerprint = req.nextUrl.searchParams.get("fingerprint") || ""

  if (!deviceId) {
    return NextResponse.json({
      active: false,
      blocked: true,
      status: null,
      expiry: null
    })
  }

  try {

    const res = await fetch(
      `${process.env.GAS_AUTH_URL}?secret=${process.env.GAS_SECRET}&device_id=${deviceId}&fingerprint=${encodeURIComponent(fingerprint)}`,
      { cache: "no-store" }
    )

    const data = await res.json()

    return NextResponse.json({
      active: Boolean(data?.active),
      blocked: Boolean(data?.blocked),
      status: data?.status ?? null,
      expiry: data?.expiry ?? null
    })

  } catch {

    return NextResponse.json({
      active: false,
      blocked: true,
      status: null,
      expiry: null
    })
  }
}



// app\layout.tsx
// --------------------------------------------------

import type { Metadata } from "next"
import { Geist, Geist_Mono } from "next/font/google"
import Script from "next/script"
import Providers from "@/components/Providers"
import "./globals.css"

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
})

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
})

export const metadata: Metadata = {
  title: "FXHEDZ",
  description: "Live Forex & Crypto Trading Dashboard",
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased tracking-tight`}
      >
        <Script
          src="https://telegram.org/js/telegram-web-app.js"
          strategy="beforeInteractive"
        />

        <Providers>
          {children}
        </Providers>

      </body>
    </html>
  )
}



// app\page.tsx
// --------------------------------------------------

"use client"

import React, { useEffect, useState, useMemo } from "react"
import PairCard from "@/components/PairCard"
import AccountStrip from "@/components/AccountStrip"
import VerticalSymbolButton from "@/components/VerticalSymbolButton"
import PairDetail from "@/components/PairDetail"
import AuthButton from "@/components/AuthButton"
import { useSession } from "next-auth/react"
import AccessOverlay from "@/components/AccessOverlay"

function generateDummySignals() {
  const base = {
    direction: "SELL",
    entry: 2345.50,
    sl: 2360.00,
    tp: 2320.00,
    price: 2342.10,
    lots: 2.40,
    buys: 0,
    sells: 3,
    orders: [
      {
        id: "d1",
        direction: "SELL",
        entry: 2345.50,
        lots: 0.80,
        profit: -12.30,
        time: "12:21:05"
      },
      {
        id: "d2",
        direction: "SELL",
        entry: 2348.20,
        lots: 0.80,
        profit: -5.40,
        time: "12:25:14"
      },
      {
        id: "d3",
        direction: "SELL",
        entry: 2350.10,
        lots: 0.80,
        profit: 3.10,
        time: "12:30:41"
      }
    ]
  }

  const pairs: any = {}

  const PAIRS = [
    "XAUUSD","BTCUSD","ETHUSD","EURUSD",
    "GBPUSD","USDJPY","AUDUSD","USDCHF","USOIL"
  ]

  PAIRS.forEach(p => {
    pairs[p] = {
      ...base,
      entry: base.entry + Math.random() * 50,
      price: base.price + Math.random() * 30
    }
  })

  return pairs
}

async function sha256(text: string) {
  const encoder = new TextEncoder()
  const data = encoder.encode(text)
  const hash = await crypto.subtle.digest("SHA-256", data)
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("")
}

const PAIRS = [
  "XAUUSD",
  "BTCUSD",
  "ETHUSD",
  "EURUSD",
  "GBPUSD",
  "USDJPY",
  "AUDUSD",
  "USDCHF",
  "USOIL"
]

const SIGNAL_API = "/api/signals"

type ViewMode = "MIN" | "MAX"

export default function Page() {

  const [signals, setSignals] = useState<any>({})
  const [pairData, setPairData] = useState<any>({})
  const [openPair, setOpenPair] = useState<string | null>(null)
  const [uiSignals, setUiSignals] = useState<any>({})
  const [netState, setNetState] = useState("FLAT")
  const [menuOpen, setMenuOpen] = useState(false)
  const [subActive, setSubActive] = useState<boolean | null>(null)
  const { data: session } = useSession()
  const [fingerprint, setFingerprint] = useState<string>("")
  const [accessMeta, setAccessMeta] = useState<any>(null)

  useEffect(() => {

    async function generateFingerprint() {

      const raw = [
        navigator.userAgent,
        screen.width,
        screen.height,
        Intl.DateTimeFormat().resolvedOptions().timeZone,
        navigator.hardwareConcurrency,
        navigator.platform,
        navigator.language
      ].join("|")

      const hash = await sha256(raw)
      setFingerprint(hash)
    }

    generateFingerprint()

  }, [])

useEffect(() => {

// If not logged in â†’ show dummy
if (!session) {
  setSignals(generateDummySignals())
  return
}

// If logged in but not active â†’ no real signals
if (subActive !== true) {
  setSignals(generateDummySignals())
  return
}
    if (!fingerprint) return

    async function loadSignals() {
      try {

        const res = await fetch(
          `${SIGNAL_API}?fingerprint=${encodeURIComponent(fingerprint)}`
        )
        const json = await res.json()
        const incoming = json?.signals ? json.signals : json

        setSignals((prev: any) => {
          if (JSON.stringify(prev) === JSON.stringify(incoming)) return prev
          return incoming
        })
      } catch { }
    }

    loadSignals()
    const interval = setInterval(loadSignals, 2500)
    return () => clearInterval(interval)

  }, [subActive, fingerprint, session])

// =============================
// CHECK SUBSCRIPTION STATUS
// =============================
useEffect(() => {

  if (!fingerprint || !session) {
    setSubActive(null)
    return
  }

  async function init() {

    let id = localStorage.getItem("fxhedz_device_id")

    if (!id) {
      if (typeof crypto !== "undefined" && crypto.randomUUID) {
        id = crypto.randomUUID()
      } else {
        id = Date.now().toString() + Math.random().toString(36).substring(2)
      }

      localStorage.setItem("fxhedz_device_id", id)
    }

    document.cookie = `fx_device=${id}; path=/; max-age=31536000; SameSite=Lax`
    document.cookie = `fx_fp=${fingerprint}; path=/; max-age=31536000; SameSite=Lax`

    await new Promise(resolve => setTimeout(resolve, 60))

    try {
      const res = await fetch(
        `/api/subscription?fingerprint=${encodeURIComponent(fingerprint)}`,
        { cache: "no-store" }
      )

      const data = await res.json()
      setSubActive(data.active)
      setAccessMeta(data)
    } catch {
      setSubActive(false)
    }
  }

  init()

}, [fingerprint, session])

  useEffect(() => {
    const timer = setTimeout(() => {
      setUiSignals((prev: any) => {
        if (JSON.stringify(prev) === JSON.stringify(signals)) return prev
        return signals
      })
    }, 90)

    return () => clearTimeout(timer)
  }, [signals])

  useEffect(() => {

    if (!openPair || subActive !== true) return
    if (!fingerprint) return

    const pairKey = openPair
    let cancelled = false

    async function refreshOpenPair() {
      try {

        const res = await fetch(
          `/api/signals?pair=${pairKey}&fingerprint=${encodeURIComponent(fingerprint)}`
        )
        const json = await res.json()
        if (cancelled) return

        setPairData((prev: any) => ({
          ...prev,
          [pairKey]: json
        }))
      } catch { }
    }

    refreshOpenPair()
    const interval = setInterval(refreshOpenPair, 6000)

    return () => {
      cancelled = true
      clearInterval(interval)
    }
  }, [openPair, subActive, fingerprint])

  function togglePair(pair: string) {
    // Toggle between open/close pair expansion
    if (openPair === pair) {
      setOpenPair(null) // Collapse the pair
    } else {
      setOpenPair(pair) // Expand the specific pair
    }
  }

  const pairsData = useMemo(() => {
    return PAIRS.map((pair) => {
      const signal = uiSignals?.[pair]
      const extra = pairData?.[pair] || {}
      return { pair, signal, orders: extra?.orders || [] }
    })
  }, [uiSignals, pairData])

  return (
    <div className="relative">

      <main
        className={`h-[100dvh] bg-black text-white flex flex-col ${session && subActive === false ? "pointer-events-none" : ""
          }`}
        style={{ fontSize: "clamp(10px, 0.9vw, 16px)" }}
      >

        {/* TOP BAR */}
        <div
          className="shrink-0 grid border-b border-neutral-800"
          style={{
            gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
            height: "clamp(26px,3vh,40px)"
          }}
        >

          {/* TOP LEFT BUTTON */}
          <button
            className="border-r border-neutral-800 bg-neutral-950 hover:bg-neutral-900"
          >
          </button>

          {/* ACCOUNT STRIP */}
          <AccountStrip
            pairs={pairsData}
            onStateChange={(state: string) => {
              setNetState(state)
            }}
          />

        </div>

        {/* SCROLL AREA */}
        <div className="flex-1 overflow-hidden relative">

          {openPair ? (

            <div
              className="absolute inset-0 grid"
              style={{
                gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
                gridTemplateRows: "1fr"
              }}
            >

              {/* LEFT RAIL */}
              <div className="grid"
                style={{
                  gridTemplateRows: "repeat(9, 1fr)"
                }}
              >
                {PAIRS.map((pair) => (
                  <VerticalSymbolButton
                    key={pair}
                    pair={pair}
                    active={openPair === pair}
                    onClick={() => setOpenPair(pair)}
                  />
                ))}
              </div>

              {/* RIGHT DETAIL */}
              <PairDetail
                pair={openPair}
                data={pairData?.[openPair]}
                signal={uiSignals?.[openPair]}
                onClose={() => setOpenPair(null)}
              />

            </div>

          ) : (

            <div
              className="h-full grid"
              style={{
                gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
                gridTemplateRows: "repeat(9, 1fr)",
                rowGap: "0px"
              }}
            >
              {PAIRS.map((pair) => {
                const signal = uiSignals?.[pair]

                return (
                  <React.Fragment key={pair}>
                    <VerticalSymbolButton
                      pair={pair}
                      active={false}
                      onClick={() => setOpenPair(pair)}
                    />

                    <PairCard
                      pair={pair}
                      direction={signal?.direction}
                      signal={signal}
                      onToggle={() => setOpenPair(pair)}
                    />
                  </React.Fragment>
                )
              })}
            </div>

          )}

        </div>

        {/* BOTTOM BAR */}
        <div
          className="shrink-0 grid border-t border-neutral-800 relative"
          style={{
            gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
            height: "clamp(26px,3vh,40px)"
          }}
        >
          {menuOpen && (
            <div className="absolute bottom-[clamp(26px,3vh,40px)] left-0 w-[260px] bg-neutral-900 border border-neutral-800 p-4 z-50">
              <AuthButton />
            </div>
          )}

          {/* BOTTOM LEFT BUTTON (HAMBURGER HERE) */}
          <button
            onClick={() => setMenuOpen(prev => !prev)}
            className="border-r border-neutral-800 bg-neutral-950 hover:bg-neutral-900 flex items-center justify-center"
          >
            <div className="w-[60%] flex flex-col gap-[2px]">
              <div className="h-[2px] w-full bg-neutral-400" />
              <div className="h-[2px] w-full bg-neutral-400" />
              <div className="h-[2px] w-full bg-neutral-400" />
            </div>
          </button>

          {/* RIGHT SIDE CONTENT */}
          <div className="bg-neutral-900 flex items-center px-2">
            <div className="text-[clamp(10px,1.8vh,22px)] font-semibold leading-none">
              FXHEDZ
            </div>

            <div className="ml-auto text-right flex flex-col items-end">
              <div className="text-[clamp(7px,0.9vh,12px)] leading-[11px]">
                ZEROLOSS COMPOUNDED
              </div>
              <div className="text-[clamp(8px,1vh,14px)] text-neutral-500 leading-[11px] tracking-[0.1em]">
                HEDGING SYSTEM
              </div>
            </div>
          </div>

        </div>

      </main>
<AccessOverlay
  active={subActive}
  sessionExists={!!session}
  status={accessMeta?.status}
  expiry={accessMeta?.expiry}
  blocked={accessMeta?.blocked}
/>
    </div>
  )
}




// components\AccessOverlay.tsx
// --------------------------------------------------

"use client"

import AuthButton from "./AuthButton"

type Props = {
  active: boolean | null
  sessionExists: boolean
  status?: string | null
  expiry?: string | null
  blocked?: boolean
}

export default function AccessOverlay({
  active,
  sessionExists,
  status,
  expiry,
  blocked
}: Props) {

  // =============================
  // 1ï¸âƒ£ LOADING
  // =============================
  if (active === null) {
    return (
      <OverlayContainer>
        <div className="text-neutral-400 text-sm">
          Verifying access...
        </div>
      </OverlayContainer>
    )
  }

  // =============================
  // 2ï¸âƒ£ ACCESS GRANTED
  // =============================
  if (active === true) {
    return null
  }

  // =============================
  // 3ï¸âƒ£ DEVICE BLOCKED
  // =============================
if (blocked) {
  return (
    <OverlayContainer>
      <div className="space-y-4 text-center max-w-sm">

        <div className="text-[10px] uppercase tracking-widest text-neutral-500">
          FXHEDZ LIVE ENGINE
        </div>

        <div className="text-xl font-semibold">
          Device Not Authorized
        </div>

        <div className="text-neutral-400 text-sm">
          This device has already consumed a trial or is not permitted.
        </div>

        <a
          href="https://t.me/fxhedzbot"
          className="px-4 py-2 bg-neutral-800 hover:bg-neutral-700 text-sm rounded-md"
        >
          Contact Support
        </a>

        <div className="pt-4">
          <AuthButton />
        </div>

      </div>
    </OverlayContainer>
  )
}

  // =============================
  // 4ï¸âƒ£ TRIAL EXPIRED (NOT LOGGED IN)
  // =============================
if (!sessionExists) {
  return (
    <OverlayContainer>
      <div className="space-y-4 text-center max-w-sm">

        <div className="text-[10px] uppercase tracking-widest text-neutral-500">
          FXHEDZ LIVE ENGINE
        </div>

        <div className="text-xl font-semibold">
          Login Required
        </div>

        <div className="text-neutral-400 text-sm">
          Sign in with Google to unlock live signals.
        </div>

        <AuthButton />

      </div>
    </OverlayContainer>
  )
}

  // =============================
  // 5ï¸âƒ£ FREE EXPIRED (LOGGED IN)
  // =============================
  if (sessionExists && status === "free") {

    const formattedExpiry = expiry
      ? new Date(expiry).toLocaleDateString()
      : null

    return (
      <OverlayContainer>
        <div className="space-y-4 text-center max-w-sm">

          <div className="text-[10px] uppercase tracking-widest text-neutral-500">
            FXHEDZ LIVE ENGINE
          </div>

          <div className="text-xl font-semibold">
            Free Access Ended
          </div>

          <div className="text-neutral-400 text-sm">
            {formattedExpiry
              ? `Your free access expired on ${formattedExpiry}.`
              : "Your free access has expired."}
          </div>

          <a
            href="https://t.me/fxhedzbot"
            className="px-4 py-2 bg-sky-600 hover:bg-sky-500 text-sm rounded-md"
          >
            Upgrade Subscription
          </a>
          <div className="pt-4">
  <AuthButton />
</div>

        </div>
      </OverlayContainer>
    )
  }

  // =============================
  // 6ï¸âƒ£ FALLBACK (SAFETY NET)
  // =============================
  return (
    <OverlayContainer>
      <div className="text-neutral-400 text-sm">
        Access restricted.
      </div>
    </OverlayContainer>
  )
}

/* -------------------------- */

function OverlayContainer({ children }: any) {
  return (
    <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
      <div className="bg-neutral-900/95 border border-neutral-800 shadow-2xl p-8 rounded-xl">
        {children}
      </div>
    </div>
  )
}



// components\AccountStrip.tsx
// --------------------------------------------------

"use client"

import { useEffect } from "react"

export default function AccountStrip({
    pairs,
    onStateChange
}: {
    pairs: any[]
    onStateChange?: (state: string, intensity: number, pulse: number) => void
}) {

    let totalFloating = 0
    let totalLots = 0
    let buyVol = 0
    let sellVol = 0

    pairs.forEach(p => {

        const orders = p.signal?.orders || []

        orders.forEach((pos: any) => {
            const lot = Number(pos.lots || 0)
            const pnl = Number(pos.profit || 0)

            totalLots += lot
            totalFloating += pnl

            if (pos.direction === "BUY") buyVol += lot
            if (pos.direction === "SELL") sellVol += lot
        })

    })

    const netState =
        buyVol === 0 && sellVol === 0
            ? "FLAT"
            : buyVol === sellVol
                ? "HEDGED"
                : buyVol > sellVol
                    ? "NET BUY"
                    : "NET SELL"

    const imbalance = Math.abs(buyVol - sellVol)
    const totalVol = buyVol + sellVol || 1
    const intensity = Math.min(1, imbalance / totalVol)
    const pulse = Math.min(1, Math.abs(totalFloating) / (totalLots || 1))

    useEffect(() => {
        if (typeof onStateChange === "function") {
            onStateChange(netState, intensity, pulse)
        }
    }, [netState, intensity, pulse])

return (
  <div className="h-full bg-neutral-900 flex px-3">

    <div className="flex-1 h-full flex items-center text-left text-[clamp(9px,1.6vw,15px)] leading-none">
<div className="flex items-center gap-[clamp(4px,0.6vw,8px)]">
  <span className="text-neutral-400">LOTS</span>
  <span className="font-semibold">{totalLots.toFixed(2)}</span>
</div>
    </div>

    <div className="flex-1 h-full flex items-center justify-center text-[clamp(9px,1.6vw,15px)] leading-none">
<div className="flex items-center gap-[clamp(4px,0.6vw,8px)]">
  <span className="text-neutral-400">~PnL</span>
  <span className={totalFloating >= 0 ? "text-green-400" : "text-red-400"}>
    {totalFloating.toFixed(2)}
  </span>
</div>
    </div>

    <div className="flex-1 h-full flex items-center justify-end text-[clamp(9px,1.6vw,15px)] font-semibold text-sky-400 leading-none">
      {netState}
    </div>

  </div>
)

}



// components\AuthButton.tsx
// --------------------------------------------------

"use client"

import { signIn, signOut, useSession } from "next-auth/react"

function getDeviceId() {
  let id = localStorage.getItem("fxhedz_device_id")

  if (!id) {
    id = crypto.randomUUID()
    localStorage.setItem("fxhedz_device_id", id)
  }

  return id
}

export default function AuthButton() {
  const { data: session, status } = useSession()

  if (status === "loading") {
    return (
      <div className="text-neutral-400 text-sm">
        Loading...
      </div>
    )
  }

  if (!session) {
    return (
      <button
        onClick={() => {
          const deviceId = getDeviceId()

          // store device id in cookie for server access
          document.cookie = `fx_device=${deviceId}; path=/; max-age=31536000`

          signIn("google")
        }}
        className="px-3 py-2 bg-neutral-800 hover:bg-neutral-700 text-sm rounded-md"
      >
        Login with Google
      </button>
    )
  }

  return (
    <div className="flex items-center gap-3">
      <span className="text-sm text-neutral-300">
        {session.user?.email}
      </span>
      <button
        onClick={() => signOut()}
        className="px-3 py-2 bg-neutral-800 hover:bg-neutral-700 text-sm rounded-md"
      >
        Logout
      </button>
    </div>
  )
}



// components\DashboardControlBar.tsx
// --------------------------------------------------

"use client"

import React from "react"

type ViewMode = "MIN" | "MID" | "MAX"

export default function DashboardControlBar({
  viewMode,
  onChangeView,
  onMenu
}: {
  viewMode: ViewMode
  onChangeView: (mode: ViewMode) => void
  onMenu?: () => void
}) {

  function Btn({
    label,
    active,
    onClick
  }: {
    label: string
    active?: boolean
    onClick: () => void
  }) {
    return (
      <button
        onClick={onClick}
        className={`px-4 py-2 text-[clamp(10px,1.4vw,14px)] font-semibold transition-all duration-200
        ${active
            ? "text-white bg-neutral-800"
            : "text-neutral-400 hover:text-neutral-200"
          }`}
      >
        {label}
      </button>
    )
  }

  return (
    <div
      className="fixed bottom-0 left-0 w-full z-50
                 bg-gradient-to-t from-black to-neutral-900
                 border-t border-neutral-800
                 rounded-t-2xl
                 backdrop-blur-xl"
      style={{
        paddingBottom: "env(safe-area-inset-bottom)"
      }}
    >
      <div className="flex items-center justify-between px-4 py-3">

        {/* LEFT SIDE â€” VIEW CONTROLS */}
        <div className="flex items-center gap-2">

          <Btn
            label="MIN"
            active={viewMode === "MIN"}
            onClick={() => onChangeView("MIN")}
          />

          <Btn
            label="MID"
            active={viewMode === "MID"}
            onClick={() => onChangeView("MID")}
          />

          <Btn
            label="MAX"
            active={viewMode === "MAX"}
            onClick={() => onChangeView("MAX")}
          />

        </div>

        {/* RIGHT SIDE â€” MENU */}
        <button
          onClick={onMenu}
          className="w-9 h-9 flex items-center justify-center
                     rounded-lg bg-neutral-800
                     text-neutral-300 hover:text-white
                     transition-all duration-200"
        >
          â˜°
        </button>

      </div>
    </div>
  )
}



// components\GlobalLightChart.tsx
// --------------------------------------------------

"use client"

import { useEffect, useRef } from "react"
import {
    createChart,
    ColorType,
    CandlestickSeries
} from "lightweight-charts"

export default function GlobalLightChart({
    mountId,
    signal
}: {
    mountId?: string
    signal?: any
}) {

    const chartRef = useRef<any>(null)
    const candleSeriesRef = useRef<any>(null)
    const dynamicLinesRef = useRef<any[]>([])
    const historyLoadedRef = useRef(false)

    // ==========================================
    // CREATE CHART
    // ==========================================
    useEffect(() => {

        if (!mountId) return

        const container = document.getElementById(mountId)
        if (!container) return

        while (container.firstChild) {
            container.removeChild(container.firstChild)
        }

const chart = createChart(container, {
    width: container.clientWidth,
    height: container.clientHeight,
    layout: {
        background: { type: ColorType.Solid, color: "#1E1E1E" },
        textColor: "#888"
    },
    grid: {
        vertLines: { color: "rgba(255,255,255,0.03)" },
        horzLines: { color: "rgba(255,255,255,0.03)" }
    },
    rightPriceScale: {
        borderColor: "rgba(255,255,255,0.08)"
    },
    timeScale: {
        borderColor: "rgba(255,255,255,0.08)",
        timeVisible: true,
        secondsVisible: false,
        rightOffset: 8,
        barSpacing: 8
    }
})

        const series = chart.addSeries(CandlestickSeries, {
            upColor: "#22c55e",
            downColor: "#ef4444",
            borderUpColor: "#22c55e",
            borderDownColor: "#ef4444",
            wickUpColor: "#22c55e",
            wickDownColor: "#ef4444"
        })

        chartRef.current = chart
        candleSeriesRef.current = series
        historyLoadedRef.current = false

        const resizeObserver = new ResizeObserver(() => {
            chart.applyOptions({
                width: container.clientWidth,
                height: container.clientHeight
            })
        })

        resizeObserver.observe(container)

        return () => {
            resizeObserver.disconnect()
            chart.remove()
        }

    }, [mountId])

    // ==========================================
    // CANDLE STREAM (IMPORTANT â€” RESTORED)
    // ==========================================
    useEffect(() => {

        const series = candleSeriesRef.current
        if (!series) return
        if (!signal?.candles) return

        const data = signal.candles.map((c: any) => ({
            time: Number(c.time),
            open: Number(c.open),
            high: Number(c.high),
            low: Number(c.low),
            close: Number(c.close)
        }))

        if (!data.length) return

        if (!historyLoadedRef.current) {
            series.setData(data)
            historyLoadedRef.current = true
            return
        }

        const last = data[data.length - 1]
        series.update(last)

    }, [signal?.candles])

    // ==========================================
    // OVERLAY ENGINE
    // ==========================================
    useEffect(() => {

        const candleSeries = candleSeriesRef.current
        if (!candleSeries || !signal) return

        dynamicLinesRef.current.forEach((l: any) => {
            candleSeries.removePriceLine(l)
        })
        dynamicLinesRef.current = []

        let orders = signal?.orders || []

        if (!orders.length && signal?.direction && signal?.entry) {
            orders = [{
                label: signal.direction === "BUY" ? "B1" : "S1",
                entry: signal.entry,
                direction: signal.direction
            }]
        }

        if (!orders.length) return

        const isHedged = signal?.direction === "HEDGED"

        orders.forEach((o: any, index: number) => {

            const entry = Number(o.entry)
            if (!entry) return

            const isLatest = index === orders.length - 1
            const isHedged = signal?.direction === "HEDGED"

            const activeColor =
                o.direction === "BUY"
                    ? "#22c55e"
                    : "#ef4444"

            // Better muted colors (visible but secondary)
            const mutedColor =
                o.direction === "BUY"
                    ? "rgba(34,197,94,0.45)"
                    : "rgba(239,68,68,0.45)"

            const color =
                isLatest && !isHedged
                    ? activeColor
                    : mutedColor

            const entryLine = candleSeries.createPriceLine({
                price: entry,
                color,
                lineWidth: isLatest && !isHedged ? 2 : 2, // keep thickness consistent
                axisLabelVisible: isLatest && !isHedged,
                title: isLatest && !isHedged ? (o.label || "") : ""
            })

            dynamicLinesRef.current.push(entryLine)

            // -------------------------------
            // STOP IF HEDGED
            // -------------------------------
            if (isHedged) return

            // Only latest non-hedged gets SL/TP
            if (!isLatest) return

            const sl = Number(signal?.sl)
            const tp = Number(signal?.tp)

            if (sl) {
                const hedgeLabel =
                    o.direction === "BUY"
                        ? "SS"
                        : "BS"

                const slLine = candleSeries.createPriceLine({
                    price: sl,
                    color: "#ef4444",
                    lineWidth: 1,
                    title: hedgeLabel
                })

                dynamicLinesRef.current.push(slLine)
            }

            if (tp) {
                const tpLine = candleSeries.createPriceLine({
                    price: tp,
                    color: "#22c55e",
                    lineWidth: 1,
                    title: "TP"
                })

                dynamicLinesRef.current.push(tpLine)
            }

        })

    }, [signal])

    return null
}



// components\PairCard.tsx
// --------------------------------------------------

"use client"

import React, { useState, useEffect } from "react"
import GlobalLightChart from "./GlobalLightChart"

type TradeDirection = "BUY" | "SELL" | "HEDGED" | "EXIT" | "--"
type ViewMode = "MIN" | "MAX"

type Props = {
  pair: string
  open?: boolean
  viewMode?: ViewMode
  direction?: TradeDirection
  signal?: any
  history?: any[]
  orders?: any[]
  performance?: any
  notes?: string
  onToggle: () => void
}

function PairCard({
  pair,
  open,
  viewMode = "MIN",
  onToggle,
  direction,
  signal,
  history,
  orders,
  performance,
  notes
}: Props) {

  const dir: TradeDirection = direction ?? "--"
  const [liveDir, setLiveDir] = useState<TradeDirection>(dir)
  const [tab, setTab] = useState<"market" | "news" | "history" | "performance">("market")
  const [liveOrders, setLiveOrders] = useState<any[]>(orders ?? [])
  const [pnlCache, setPnlCache] = useState<Record<string, number>>({})
  const expanded = !!open

  useEffect(() => setLiveDir(dir), [dir])
  useEffect(() => setLiveOrders(orders ?? []), [orders])
  useEffect(() => { if (expanded) setTab("market") }, [expanded])
useEffect(() => {
  const newCache: Record<string, number> = {}
  liveOrders.forEach(o => {
    const key = o.id || `${o.direction}_${o.entry}_${o.time}`
    newCache[key] = Number(o.profit ?? 0)
  })
  setPnlCache(newCache)
}, [liveOrders])

  return (
<div
  className={`
    text-[clamp(10px,1.1vw,20px)]
    relative
    transition-all duration-300
    border border-neutral-800 rounded-none
    overflow-hidden flex flex-col
    ${viewMode === "MIN" && !expanded ? "justify-center" : ""}
    flex-none
    ${expanded ? "z-20 shadow-xl" : "z-0"}
  `}
>

{/* ================= HEADER ================== */}
<div
  className="
    flex-shrink-0
    flex flex-col
    justify-center
    px-3
py-[clamp(2px,0.6vh,6px)]
    cursor-pointer
  "
  onClick={(e) => {
    e.stopPropagation()
    onToggle()
  }}
>

  {signal && (
    <div className="flex flex-col w-full">

      {/* ROW 1 â€” PAIR + DIRECTION */}
      <div className="flex justify-between items-center">
        <div className="font-semibold text-[clamp(10px,1.8vh,22px)] leading-none">
          {pair}
        </div>

        <div className={`font-bold text-[clamp(10px,1.8vh,22px)] ${
          liveDir === "BUY"
            ? "text-green-400"
            : liveDir === "SELL"
              ? "text-red-400"
              : liveDir === "HEDGED"
                ? "text-sky-400"
                : "text-neutral-500"
        }`}>
          {liveDir}
        </div>
      </div>

{/* ROW 2 â€” LOTS + B/S COUNT */}
<div className="mt-[clamp(1px,0.4vw,6px)] flex justify-between items-center text-[clamp(8px,1.3vh,18px)] leading-none">
        <div className="text-neutral-400">
          {signal?.lots ?? "-"} LOTS
        </div>

        <div className="font-semibold">
          <span className="text-green-400">{signal?.buys ?? 0}B</span>
          <span className="text-neutral-500 px-1">/</span>
          <span className="text-red-400">{signal?.sells ?? 0}S</span>
        </div>
      </div>

      {/* ROW 3 â€” TRADE BAR */}
<div className="mt-[clamp(1px,0.8vw,10px)]">
  <InlineTradeStrip
    signal={signal}
    direction={liveDir}
  />
</div>

    </div>
  )}
</div>

      {/* ================= EXPANDED CONTENT ================ */}
      {expanded && (
        <div className="border-t border-neutral-800 flex flex-col flex-1 min-h-0 overflow-y-auto">

          {/* TABS */}
          <div className="flex w-full border-b border-neutral-800 text-[clamp(10px,1.4vw,14px)]">
            <TabBtn label="Market" active={tab === "market"} onClick={() => setTab("market")} />
            <TabBtn label="News" active={tab === "news"} onClick={() => setTab("news")} />
            <TabBtn label="History" active={tab === "history"} onClick={() => setTab("history")} />
            <TabBtn label="Performance" active={tab === "performance"} onClick={() => setTab("performance")} />
          </div>

          <div className="p-3 space-y-3 flex flex-col h-full">

            {/* ================= MARKET ================= */}
            {tab === "market" && (
              <>
                <div
                  id={`chart_mount_${pair}`}
                  className="w-full h-[35vh] min-h-[180px] max-h-[320px]"
                />
                <GlobalLightChart
                  mountId={`chart_mount_${pair}`}
                  signal={signal}
                />

                <div>
                  <div className="text-[clamp(10px,1.4vw,14px)] text-neutral-400">Latest Signal</div>
                  <div className="font-bold text-lg">
                    {signal?.direction || "--"} {signal?.entry || ""}
                  </div>
                  <div className="text-[clamp(10px,1.4vw,14px)] text-neutral-400">
                    SL {signal?.sl || "--"} Â· TP {signal?.tp || "--"}
                  </div>
                </div>

                <div className="bg-neutral-800 rounded-lg p-2 text-[clamp(10px,1.4vw,14px)] text-neutral-300">
                  <div className="text-[clamp(10px,1.4vw,14px)] text-neutral-400 mb-2">Active Orders</div>

                  <div className="flex-1 min-h-0 overflow-y-auto space-y-2 pr-1">
                    {liveOrders?.length ? liveOrders.map((o, i) => {

                      const key = o.id || `${o.direction}_${o.entry}_${o.time}`
                      const pnl = Number(o.profit ?? 0)
                      const prev = pnlCache[key] ?? pnl

                      const pnlColor =
                        pnl > 0
                          ? "text-green-400"
                          : pnl < 0
                            ? "text-red-400"
                            : "text-neutral-400"

                      let pulseClass = ""
                      if (pnl > prev) pulseClass = "ring-1 ring-green-400/40"
                      if (pnl < prev) pulseClass = "ring-1 ring-red-400/40"

                      return (
                        <div
                          key={key}
                          className={`bg-neutral-900 px-2 py-2 min-h-[38px] rounded-md text-xs flex justify-between ...`}
>
                          <div>
                            <div className={`font-semibold ${o.direction === "BUY"
                              ? "text-green-400"
                              : "text-red-400"
                              }`}>
                              {o.direction}
                            </div>
                            <div className="text-neutral-400">
                              ENTRY {o.entry}
                            </div>
                          </div>

                          <div className="text-right">
                            <div className="text-neutral-400">
                              {o.lots}
                            </div>
                            <div className={pnlColor}>
                              {pnl.toFixed(2)}
                            </div>
                          </div>
                        </div>
                      )

                    }) : (
                      <div className="text-neutral-500 text-[clamp(10px,1.4vw,14px)]">
                        No open orders
                      </div>
                    )}
                  </div>
                </div>
              </>
            )}

            {/* ================= NEWS ================= */}
{tab === "news" && (
  <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

    <div className="shrink-0 text-[clamp(10px,1.4vw,14px)] text-neutral-400 mb-2">
      Market Commentary
    </div>

    <div className="flex-1 min-h-0 overflow-y-auto bg-neutral-900 border border-neutral-800 p-[clamp(10px,1.4vw,16px)] text-[clamp(10px,1.4vw,14px)]">
      {notes || "Coming Soon"}
    </div>

  </div>
)}

            {/* ================= HISTORY ================= */}
{tab === "history" && (
  <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

    <div className="flex-1 min-h-0 overflow-y-auto space-y-3 pr-1">

      {history?.length ? history.map((h: any, i: number) => (
        <div
          key={i}
          className="bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] flex justify-between text-[clamp(10px,1.4vw,14px)]"
        >
          <div>
            <div className={h.direction === "BUY" ? "text-green-400" : "text-red-400"}>
              {h.direction}
            </div>
            <div className="text-xs text-neutral-400">
              {h.entry} â†’ {h.exit}
            </div>
          </div>
          <div className={h.pnl >= 0 ? "text-green-400" : "text-red-400"}>
            {h.pnl}
          </div>
        </div>
      )) : (
        <div className="text-neutral-500 text-[clamp(10px,1.4vw,14px)]">
          No history yet
        </div>
      )}

    </div>

  </div>
)}

            {/* ================= PERFORMANCE ================= */}
{tab === "performance" && (
  <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

    <div className="flex-1 min-h-0 overflow-y-auto space-y-[clamp(8px,1vh,16px)] pr-1">

      {/* TOP METRICS */}
      <div className="grid grid-cols-2 gap-[clamp(6px,1vw,14px)] text-[clamp(10px,1.4vw,14px)]">
        <Metric
          label="Win Rate"
          value={
            performance?.winRate !== undefined
              ? performance.winRate + "%"
              : "--"
          }
        />
        <Metric
          label="Profit Factor"
          value={performance?.profitFactor ?? "--"}
        />
      </div>

      {/* STAT LIST */}
      <div className="space-y-[clamp(6px,1vh,12px)] text-[clamp(10px,1.4vw,14px)]">
        <Stat label="Total Trades" value={performance?.trades} />
        <Stat label="Wins" value={performance?.wins} />
        <Stat label="Losses" value={performance?.losses} />
        <Stat label="Total PnL" value={performance?.pnlTotal} />
      </div>

    </div>

  </div>
)}

          </div>
        </div>
      )}

    </div>
  )
}

/* ====================================================== */

function TabBtn({ label, active, onClick }: any) {
  return (
    <button
      onClick={(e) => { e.stopPropagation(); onClick() }}
      className={`flex-1 py-3 text-center transition-all duration-200 ${active
        ? "text-white border-b-2 border-white bg-neutral-900"
        : "text-neutral-500 hover:text-neutral-300"
        }`}
    >
      {label}
    </button>
  )
}

function Stat({ label, value }: any) {
  return (
    <div className="flex justify-between bg-neutral-800 border border-neutral-700 p-[clamp(8px,1vw,14px)]">
      <span className="text-neutral-400">{label}</span>
      <span className="font-semibold">{value ?? "--"}</span>
    </div>
  )
}

function Metric({ label, value }: any) {
  return (
    <div className="bg-neutral-800 border border-neutral-700 p-[clamp(10px,1.4vw,18px)] text-center">
      <div className="text-neutral-400 text-[clamp(9px,1.2vw,12px)]">{label}</div>
      <div className="text-[clamp(12px,1.8vw,20px)] font-semibold">{value ?? "--"}</div>
    </div>
  )
}

/* =====================================================
   INLINE STRIP (MIN MODE)
======================================================= */

function InlineTradeStrip({ signal, direction }: any) {
  if (!signal?.entry || direction === "EXIT") return null

  const sl = Number(signal?.sl)
  const tp = Number(signal?.tp)
  const entry = Number(signal?.entry)
  const price = Number(signal?.price || entry)

  if (!sl || !tp) return null

  let pricePercent = 50

  if (direction === "BUY") {
    const leftRange = Math.abs(entry - sl)
    const rightRange = Math.abs(tp - entry)

    if (price < entry && leftRange > 0)
      pricePercent = 50 - ((entry - price) / leftRange) * 50

    if (price > entry && rightRange > 0)
      pricePercent = 50 + ((price - entry) / rightRange) * 50
  }

  if (direction === "SELL") {
    const leftRange = Math.abs(tp - entry)
    const rightRange = Math.abs(entry - sl)

    if (price > entry && rightRange > 0)
      pricePercent = 50 - ((price - entry) / rightRange) * 50

    if (price < entry && leftRange > 0)
      pricePercent = 50 + ((entry - price) / leftRange) * 50
  }

  pricePercent = Math.max(0.9, Math.min(99.2, pricePercent))

  const isTPside =
    direction === "BUY"
      ? price >= entry
      : price <= entry

  return (
    <div className="flex flex-col w-full gap-[clamp(1px,0.5vw,6px)]">

      {/* BAR */}
      <div className="relative w-full h-[clamp(2px,0.35vw,6px)]">

        <div className="absolute inset-0 bg-neutral-800 rounded-full" />

        {/* left half */}
        <div className="absolute left-0 h-[clamp(2px,0.35vw,6px)] w-1/2 bg-red-500/70" />

        {/* right half */}
        <div className="absolute right-0 h-[clamp(2px,0.35vw,6px)] w-1/2 bg-green-500/70" />

        {/* SL dot */}
        <div className="absolute left-0 top-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full border border-neutral-500 bg-black" />

{/* ENTRY dot */}
<div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full bg-neutral-400" />

        {/* TP dot */}
        <div className="absolute right-0 top-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full border border-neutral-500 bg-black" />

{/* LIVE DOT */}
<div
  className="absolute top-1/2"
  style={{
    left: `${pricePercent}%`,
    transform: "translate(-50%, -50%)",
    transition: "left 300ms ease"
  }}
>

  {/* OUTER PULSE RING â€” MODERATE */}
  <div
    className={`
      absolute
      w-[clamp(12px,1.8vw,36px)]
      h-[clamp(12px,1.8vw,36px)]
      -translate-x-1/2
      -translate-y-1/2
      left-1/2
      top-1/2
      rounded-full
      ${isTPside ? "bg-green-400/35" : "bg-red-400/35"}
      animate-ping
    `}
    style={{
      animationDuration: "0.85s"
    }}
  />

  {/* STATIC SOFT HALO */}
  <div
    className={`
      absolute
      w-[clamp(9px,1.4vw,28px)]
      h-[clamp(9px,1.4vw,28px)]
      -translate-x-1/2
      -translate-y-1/2
      left-1/2
      top-1/2
      rounded-full
      blur-lg
      ${isTPside ? "bg-green-500/45" : "bg-red-500/45"}
    `}
  />

  {/* CORE DOT â€” EXACT SIZE YOU WANT */}
  <div
    className={`
      relative
      w-[clamp(6px,1.3vw,28px)]
      h-[clamp(6px,1.3vw,28px)]
      rounded-full
      ${isTPside ? "bg-green-400" : "bg-red-400"}
    `}
  />

</div>

      </div>

      {/* PRICE ROW */}
      <div className="flex justify-between text-[clamp(8px,2.4vw,16px)] text-neutral-400">
        <span>{sl}</span>
        <span>{entry}</span>
        <span>{tp}</span>
      </div>

    </div>
  )
}
/* ======================================================
   TRADE BAR (MID / MAX MODE)
====================================================== */

function TradeBar({
  signal,
  direction
}: {
  signal: any
  direction?: "BUY" | "SELL" | "HEDGED" | "EXIT" | "--"
}) {

  const sl = Number(signal?.sl)
  const tp = Number(signal?.tp)
  const entry = Number(signal?.entry)
  const price = Number(signal?.price || entry)

  if (direction === "EXIT") return null
  if (!sl || !tp || !entry) return null

  const entryPercent = 50
  let pricePercent = 50

  if (direction === "BUY") {
    const leftRange = Math.abs(entry - sl)
    const rightRange = Math.abs(tp - entry)

    if (price < entry && leftRange > 0)
      pricePercent = 50 - ((entry - price) / leftRange) * 50

    if (price > entry && rightRange > 0)
      pricePercent = 50 + ((price - entry) / rightRange) * 50
  }

  if (direction === "SELL") {
    const leftRange = Math.abs(tp - entry)
    const rightRange = Math.abs(entry - sl)

    if (price > entry && rightRange > 0)
      pricePercent = 50 - ((price - entry) / rightRange) * 50

    if (price < entry && leftRange > 0)
      pricePercent = 50 + ((entry - price) / leftRange) * 50
  }

  pricePercent = Math.max(0.9, Math.min(99.2, pricePercent))

  const isTPside =
    direction === "BUY"
      ? price >= entry
      : price <= entry

  return (
    <div className="mt-3 select-none">

      <div className="relative h-3 text-[clamp(12px,1vw,16px)] text-neutral-400 mb-1">
        <span className="absolute left-0">SL / HEDZ</span>
        <span
          className="absolute"
          style={{
            left: `${entryPercent}%`,
            transform: "translateX(-50%)"
          }}
        >
          ENTRY
        </span>
        <span className="absolute right-0">TP</span>
      </div>

      <div className="relative h-6 flex items-center overflow-visible">

        <div
          className="absolute h-[clamp(2px,0.35vw,6px)]"
          style={{
            width: `${entryPercent}%`,
            background:
              "linear-gradient(90deg, rgba(248,113,113,0.8), rgba(239,68,68,0.05))"
          }}
        />

        <div
          className="absolute h-[clamp(2px,0.35vw,6px)]"
          style={{
            left: `${entryPercent}%`,
            width: `${100 - entryPercent}%`,
            background:
              "linear-gradient(90deg, rgba(34,197,94,0.05), rgba(74,222,128,0.8))"
          }}
        />

        <div className="absolute left-0 w-3 h-3 rounded-full border border-neutral-400" />
        <div
          className="absolute w-3 h-3 rounded-full border border-neutral-400"
          style={{
            left: `${entryPercent}%`,
            transform: "translateX(-50%)"
          }}
        />
        <div className="absolute right-0 w-3 h-3 rounded-full border border-neutral-400" />

        <div
          className="absolute"
          style={{
            left: `${pricePercent}%`,
            transform: "translateX(-50%)",
            transition: "left 380ms cubic-bezier(0.22,1,0.36,1)"
          }}
        >
          <div
            className={`absolute -inset-2 rounded-full blur-md ${isTPside ? "bg-green-500/30" : "bg-red-500/30"
              }`}
          />
          <div
            className={`w-3 h-3 rounded-full ${isTPside ? "bg-green-400" : "bg-red-400"
              }`}
          />
        </div>

      </div>

      <div className="flex justify-between text-[11px] text-neutral-400 mt-1">
        <span>{sl}</span>
        <span>{entry}</span>
        <span>{tp}</span>
      </div>

    </div>
  )
}

export default React.memo(PairCard)



// components\PairDetail.tsx
// --------------------------------------------------

"use client"

import { useState } from "react"
import GlobalLightChart from "./GlobalLightChart"

type Props = {
    pair: string
    signal: any
    data: any
    onClose: () => void
}

export default function PairDetail({
    pair,
    signal,
    data,
    onClose
}: Props) {

    const [tab, setTab] = useState<"market" | "news" | "history" | "performance">("market")

    return (
        <div className="flex flex-col h-full bg-black min-h-0">

            {/* HEADER */}
            <div className="shrink-0 flex items-center justify-between px-3 py-[clamp(6px,1vh,10px)] border-b border-neutral-800">
                <div className="font-semibold text-[clamp(12px,1.8vw,18px)] leading-none">
                    {pair}
                </div>
                <button
                    onClick={onClose}
                    className="text-[clamp(10px,1.6vw,14px)] text-neutral-400 hover:text-white leading-none"
                >
                    CLOSE
                </button>
            </div>

            {/* CHART (FIXED HEIGHT) */}
            <div className="shrink-0 h-[clamp(180px,35vh,380px)]">
                <div
                    id={`chart_mount_${pair}`}
                    className="w-full h-full"
                />
                <GlobalLightChart
                    mountId={`chart_mount_${pair}`}
                    signal={signal}
                />
            </div>

            {/* TABS (FIXED) */}
            <div className="shrink-0 flex border-b border-neutral-800 text-[clamp(10px,1.4vw,14px)]">
                <Tab label="Market" active={tab === "market"} onClick={() => setTab("market")} />
                <Tab label="News" active={tab === "news"} onClick={() => setTab("news")} />
                <Tab label="History" active={tab === "history"} onClick={() => setTab("history")} />
                <Tab label="Statistics" active={tab === "performance"} onClick={() => setTab("performance")} />
            </div>

            {/* CONTENT AREA â€” ONLY THIS SCROLLS */}
            <div className="flex-1 flex flex-col min-h-0">

                {tab === "market" && (
                    <div className="flex flex-col flex-1 min-h-0 gap-[clamp(8px,1vh,16px)] p-[clamp(8px,1.2vw,16px)]">


                        <div>
                            <div className="text-[clamp(10px,1.4vw,14px)] text-neutral-400">Latest Signal</div>
                            <div className="font-semibold text-[clamp(12px,1.8vw,18px)] leading-tight">
                                {signal?.direction || "--"} {signal?.entry || ""}
                            </div>
                            <div className="text-[clamp(10px,1.4vw,14px)] text-neutral-400">
                                SL {signal?.sl || "--"} Â· TP {signal?.tp || "--"}
                            </div>
                        </div>

                        <div className="flex flex-col flex-1 min-h-0 bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] text-[clamp(10px,1.4vw,15px)]">

                            <div className="shrink-0 text-neutral-400 mb-2">
                                Active Orders
                            </div>

                            <div className="flex-1 overflow-y-auto space-y-2 pr-1">

                                {data?.orders?.length ? data.orders.map((o: any, i: number) => (
                                    <div
                                        key={i}
                                        className="flex justify-between bg-neutral-800 p-2"
                                    >
                                        <div>
                                            <div className={o.direction === "BUY" ? "text-green-400" : "text-red-400"}>
                                                {o.direction}
                                            </div>
                                            <div className="text-neutral-400 text-xs">
                                                ENTRY {o.entry}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div>{o.lots}</div>
                                            <div className={Number(o.profit) >= 0 ? "text-green-400" : "text-red-400"}>
                                                {Number(o.profit).toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                )) : (
                                    <div className="text-neutral-500">
                                        No open orders
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>
                )}

                {tab === "news" && (
                    <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                        <div className="shrink-0 text-neutral-400 mb-2">
                            Market Commentary
                        </div>

                        <div className="flex-1 min-h-0 overflow-y-auto bg-neutral-900 border border-neutral-800 p-[clamp(10px,1.4vw,16px)] text-[clamp(10px,1.4vw,14px)] pr-1">
                            {data?.notes || "Coming Soon"}
                        </div>

                    </div>
                )}

                {tab === "history" && (
                    <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                        <div className="flex-1 min-h-0 overflow-y-auto space-y-3 pr-1">

                            {data?.history?.length ? data.history.map((h: any, i: number) => (
                                <div
                                    key={i}
                                    className="bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] flex justify-between text-[clamp(10px,1.4vw,14px)]"
                                >
                                    <div>
                                        <div className={h.direction === "BUY" ? "text-green-400" : "text-red-400"}>
                                            {h.direction}
                                        </div>
                                        <div className="text-xs text-neutral-400">
                                            {h.entry} â†’ {h.exit}
                                        </div>
                                    </div>
                                    <div className={h.pnl >= 0 ? "text-green-400" : "text-red-400"}>
                                        {h.pnl}
                                    </div>
                                </div>
                            )) : (
                                <div className="text-neutral-500 text-[clamp(10px,1.4vw,14px)]">
                                    No history yet
                                </div>
                            )}

                        </div>

                    </div>
                )}

                {tab === "performance" && (
                    <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                        <div className="flex-1 min-h-0 overflow-y-auto space-y-[clamp(8px,1vh,16px)] pr-1">

                            <div className="grid grid-cols-2 gap-[clamp(6px,1vw,14px)] text-[clamp(10px,1.4vw,14px)]">
                                <Metric
                                    label="Win Rate"
                                    value={
                                        data?.performance?.winRate !== undefined
                                            ? data.performance.winRate + "%"
                                            : "--"
                                    }
                                />
                                <Metric
                                    label="Profit Factor"
                                    value={data?.performance?.profitFactor ?? "--"}
                                />
                            </div>

                            <div className="space-y-[clamp(6px,1vh,12px)] text-[clamp(10px,1.4vw,14px)]">
                                <Stat label="Total Trades" value={data?.performance?.trades} />
                                <Stat label="Wins" value={data?.performance?.wins} />
                                <Stat label="Losses" value={data?.performance?.losses} />
                                <Stat label="Total PnL" value={data?.performance?.pnlTotal} />
                            </div>

                        </div>

                    </div>
                )}
            </div>

        </div>
    )
}

function Tab({ label, active, onClick }: any) {
    return (
        <button
            onClick={onClick}
            className={`
        flex-1
        py-[clamp(6px,1vh,12px)]
        text-[clamp(10px,1.6vw,16px)]
        leading-none
        transition-all
        ${active
                    ? "text-white border-b-2 border-white bg-neutral-900"
                    : "text-neutral-500 hover:text-neutral-300"}
      `}
        >
            {label.toUpperCase()}
        </button>
    )
}

function Stat({ label, value }: any) {
    return (
        <div className="flex justify-between bg-neutral-800 border border-neutral-700 p-[clamp(8px,1vw,14px)]">
            <span className="text-neutral-400">{label}</span>
            <span className="font-semibold">{value ?? "--"}</span>
        </div>
    )
}

function Metric({ label, value }: any) {
    return (
        <div className="bg-neutral-800 border border-neutral-700 p-[clamp(10px,1.4vw,18px)] text-center">
            <div className="text-neutral-400 text-[clamp(9px,1.2vw,12px)]">{label}</div>
            <div className="text-[clamp(12px,1.8vw,20px)] font-semibold">{value ?? "--"}</div>
        </div>
    )
}





// components\Providers.tsx
// --------------------------------------------------

"use client"

import { SessionProvider } from "next-auth/react"

export default function Providers({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <SessionProvider>
      {children}
    </SessionProvider>
  )
}



// components\VerticalSymbolButton.tsx
// --------------------------------------------------

"use client"

type Props = {
  pair: string
  active?: boolean
  onClick: () => void
}

function splitPair(pair: string) {
  const knownQuotes = ["USD", "JPY", "CHF", "OIL"]

  for (const quote of knownQuotes) {
    if (pair.endsWith(quote)) {
      return {
        base: pair.slice(0, pair.length - quote.length),
        quote
      }
    }
  }

  return {
    base: pair.slice(0, 3),
    quote: pair.slice(3)
  }
}

export default function VerticalSymbolButton({
  pair,
  active = false,
  onClick
}: Props) {

  const { base, quote } = splitPair(pair)

  return (
    <button
      onClick={onClick}
      className={`
        h-full w-full
        flex items-center justify-center
        border border-neutral-800
        rounded-none
        ${active
          ? "bg-neutral-900 text-white border-sky-400"
          : "bg-neutral-950 text-neutral-500 hover:bg-neutral-900"
        }
      `}
    >
      <div className="flex flex-col items-center leading-[1.05]">
        <span className="text-[clamp(8px,1vh,13px)] font-semibold tracking-wide">
          {base}
        </span>
        <span className="text-[clamp(8px,1vh,13px)] text-neutral-400 tracking-wide">
          {quote}
        </span>
      </div>
    </button>
  )
}



// package.json
// --------------------------------------------------

{
  "name": "fxhedz",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "set NEXT_DISABLE_TURBOPACK=1 && next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "lightweight-charts": "^5.1.0",
    "next": "16.1.6",
    "next-auth": "^4.24.13",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.24",
    "cross-env": "^10.1.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.4",
    "typescript": "^5"
  }
}



// next.config.ts
// --------------------------------------------------

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  reactStrictMode: false,
};

export default nextConfig;



// tsconfig.json
// --------------------------------------------------

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


